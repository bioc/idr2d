---
title: "IDR2D: Irreproducible Discovery Rate for Genomic Interactions"
author: "Konstantin Krismer"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: bibliography.bib
vignette: >
  %\VignetteIndexEntry{Spectrum Motif Motif Analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

IDR2D is an extension of the original method IDR, which is intended for
ChIP-Seq peaks (or one-dimensional genomic data). This package applies the
method to two-dimensional genomic data, such as interactions between two
genomic loci (also called anchors). Genomic interaction data is generated by
genome-wide methods such as HiC [@pmid20461051], ChIA-PET [@pmid19247990], 
and HiChIP [@pmid25128017].

# Input data

Load example data:
```{r, message = FALSE}
rep1.df <- idr2d:::chiapet$rep1.df
rep2.df <- idr2d:::chiapet$rep2.df
```

## Example data - replicate 1

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(DT)
header <- htmltools::withTags(table(
  class = 'display',
  thead(
    tr(
      th(colspan = 3, "anchor A"),
      th(colspan = 3, "anchor B"),
      th(rowspan = 2, "FDR")
    ),
    tr(
      lapply(rep(c("chr.", "start coordinate", "end coordinate"), 2), th)
    )
  )
))
datatable(rep1.df, container = header, rownames = FALSE,
              options = list(searching = FALSE)) %>%
    formatRound("fdr", 3)
```

## Example data - replicate 2

```{r, echo = FALSE, warning = FALSE, message = FALSE}
datatable(rep2.df, container = header, rownames = FALSE,
              options = list(searching = FALSE)) %>%
    formatRound("fdr", 3)
```


# IDR2D analysis

Load the package:
```{r}
library(idr2d)
```

Estimate IDR:
```{r}
idr.results <- estimateIDR(rep1.df, rep2.df,
                           value.transformation = "log.additive.inverse")
rep1.idr.df <- idr.results$rep1.df
```

Important to note here is that the appropriate value transformation depends
on the semantics of the *value* column (always the seventh column) in `rep1.df`
and `rep2.df`. This column is used to establish a ranking between interactions,
with highly significant interactions on top of the list and least significant
interactions (i.e., most likely noise) at the bottom of the list. The ranking
is established by the *value* column, sorted in descending order. Since our 
*value* column contains FDRs (the lower, the more significant), we need to
transform the values to comply with the assumption that high values indicate
high significance. For p-values and p-value derived measures (like Q values),
the `log.additive.inverse` transformation (`-log(x)`) is recommended.

## Results (`rep1.idr.df`)

```{r, echo = FALSE, warning = FALSE, message = FALSE}
header <- htmltools::withTags(table(
  class = 'display',
  thead(
    tr(
      th(colspan = 3, "anchor A"),
      th(colspan = 3, "anchor B"),
      th(rowspan = 2, "FDR"),
      th(rowspan = 2, "IDR")
    ),
    tr(
      lapply(rep(c("chr.", "start coordinate", "end coordinate"), 2), th)
    )
  )
))
datatable(rep1.idr.df, 
          rownames = FALSE,
          options = list(searching = FALSE),
          container = header) %>%
    formatRound(c("fdr", "idr"), 3)
```

# Additional information

Most of the functionality of the IDR2D package is also offered through 
the website at https://idr2d.mit.edu.

For a more detailed discussion on IDR2D, please have a look at 
this preprint on bioRxiv:

**IDR2D: title**  
Konstantin Krismer, Yuchun Guo, and David K. Gifford
bioRxiv XX; doi: https://doi.org/XX

# References
